import { spawnSync } from "node:child_process";
import { createSerwistRoute } from "@serwist/turbopack";

const revision =
	process.env.VERCEL_GIT_COMMIT_SHA ??
	spawnSync("git", ["rev-parse", "HEAD"], { encoding: "utf-8" }).stdout?.trim() ??
	crypto.randomUUID();

export const { dynamic, dynamicParams, revalidate, generateStaticParams, GET } = createSerwistRoute({
	additionalPrecacheEntries: [
		{ url: "/~offline", revision },
		{ url: "/icons/offline-placeholder.svg", revision },
	],
	swSrc: "app/sw.ts",
	nextConfig: {},
});
